<!DOCTYPE html>
<html>
    <head>
        <title>D3 - Data Driven Drivel</title>
        <link rel="stylesheet" type="text/css" href="./styles.css">
      </head>
      <body>
        <div id="chart"></div>
        
        <button onclick="updateChart('math')">Math</button>
        <button onclick="updateChart('science')">Science</button>
        <button onclick="updateChart('reading')">Reading</button>                

        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
        
        <script type="text/javascript">
          var w = 600;
          var h = 400;
          var path;
          var subjects;

          $.getJSON('//jsbin.com/vegaqi/1.js', function(jsonResponse) {
            subjects = jsonResponse;

            _.keys(subjects).forEach(function(subject) {
              subjects[subject].forEach(d => d.date = d3.time.format("%Y%m%d").parse(d.date)); //This is D3's time formatter
            });

            path = d3
              .select('#chart')
              .append('svg')
              .attr('width', '100%')
              .attr('height', '100%')
              .append('g') //graphic object
              .append('path')

            updateChart('math');
          });

          function updateChart(subject) {
            var data = subjects[subject]; //i.e., select 'math', 'science', or 'reading'
            var dates = _.pluck(data, 'date');
            var counts = _.pluck(data, 'count');
            
            var x = d3.time.scale()
                          .domain(d3.extent(dates)) //This examines all of the dates in the array, then returns a two-element array with the smallest and largest numbers in it.
                          .range([0, w]);

            var y = d3.scale.linear()
                            .domain(d3.extent(counts))
                            .range([h, 0])

            //FOR MAKING A LINE CHART
            // var line = d3.svg.line()
            //                 .interpolate('bundle') //Causes the line to curve smoothly rather than be jagged as it goes from point to point. Yeah!
            //                 .x(d => x(d.date))
            //                 .y(d => y(d.count));

            // FOR MAKING AN AREA CHART
            var area = d3.svg.area()
                            .interpolate('bundle') //Causes the line to curve smoothly rather than be jagged as it goes from point to point. Yeah!
                            .x(d => x(d.date))
                            .y0(d => y(0)) //y0 = bottom of area's reach (in a bar chart, y0 = the lower y value of a bar). We're returning y(0) because we want the colored area to stretch all the way down to the x axis. Woot.
                            .y1(d => y(d.count)); //y1 = top of area's reach (in a bar chart, y1 = the upper y value of a bar)
            
            path
              .datum(data) //This says, use this data for the path object (rather than using it to make a bunch of little objects, like when we called data and made circles or bars)
              .transition()
              .duration(450)
              .attr('d', area);
          }

        </script>
    </body>
</html>